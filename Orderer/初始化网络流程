<mxfile host="www.draw.io" modified="2019-10-31T09:25:42.721Z" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.2 Safari/605.1.15" etag="Poc0X-AIjXRuQ9KP9FJJ" version="12.1.8" type="github" pages="1">
  <diagram id="bODEemjm7WuG4UsOOL89" name="Page-1">
    <mxGraphModel dx="1096" dy="669" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="3300" pageHeight="4681" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        <mxCell id="zyuMUPi6konpD5LrwUrA-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="zyuMUPi6konpD5LrwUrA-1" target="zyuMUPi6konpD5LrwUrA-2" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="zyuMUPi6konpD5LrwUrA-1" value="&lt;pre style=&quot;background-color: rgb(253 , 246 , 227) ; color: rgb(88 , 110 , 117) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;networkv2.Init&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="40" y="100" width="300" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="zyuMUPi6konpD5LrwUrA-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="zyuMUPi6konpD5LrwUrA-2" target="zyuMUPi6konpD5LrwUrA-4" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="zyuMUPi6konpD5LrwUrA-2" value="&lt;pre style=&quot;background-color: rgb(253 , 246 , 227) ; color: rgb(88 , 110 , 117) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;servicev2.InitNetwork(initRequest)&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="400" y="100" width="330" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="zyuMUPi6konpD5LrwUrA-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="zyuMUPi6konpD5LrwUrA-4" target="zyuMUPi6konpD5LrwUrA-6" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="zyuMUPi6konpD5LrwUrA-4" value="&lt;pre style=&quot;background-color: rgb(253 , 246 , 227) ; color: rgb(88 , 110 , 117) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;createResourcesInDb&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="790" y="100" width="190" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="MySstw2kXxZv5NEbaLpW-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="zyuMUPi6konpD5LrwUrA-6" target="MySstw2kXxZv5NEbaLpW-1" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="zyuMUPi6konpD5LrwUrA-6" value="&lt;pre style=&quot;background-color: rgb(253 , 246 , 227) ; color: rgb(88 , 110 , 117) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;createOrgs&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="825" y="190" width="120" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="MySstw2kXxZv5NEbaLpW-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="MySstw2kXxZv5NEbaLpW-1" target="MySstw2kXxZv5NEbaLpW-3" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="MySstw2kXxZv5NEbaLpW-1" value="&lt;pre style=&quot;background-color: rgb(253 , 246 , 227) ; color: rgb(88 , 110 , 117) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;createOrg&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="660" y="190" width="120" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="MySstw2kXxZv5NEbaLpW-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="MySstw2kXxZv5NEbaLpW-3" target="MySstw2kXxZv5NEbaLpW-5" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="MySstw2kXxZv5NEbaLpW-3" value="&lt;pre style=&quot;background-color: rgb(253 , 246 , 227) ; color: rgb(88 , 110 , 117) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;svcmsp.CreateOrganizationByNetwork&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="290" y="190" width="330" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="MySstw2kXxZv5NEbaLpW-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="MySstw2kXxZv5NEbaLpW-5" target="MySstw2kXxZv5NEbaLpW-7" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="MySstw2kXxZv5NEbaLpW-5" value="&lt;pre style=&quot;background-color: rgb(253 , 246 , 227) ; color: rgb(88 , 110 , 117) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;createOrganization&lt;/pre&gt;&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="40" y="190" width="170" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="MySstw2kXxZv5NEbaLpW-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="MySstw2kXxZv5NEbaLpW-7" target="MySstw2kXxZv5NEbaLpW-9" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="MySstw2kXxZv5NEbaLpW-7" value="&lt;pre style=&quot;background-color: rgb(253 , 246 , 227) ; color: rgb(88 , 110 , 117) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;getCryptoGen().CreateOrganization&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;创建组织ordererOrganization CA私钥和根证书,&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;TLS私钥和根证书&lt;span style=&quot;font-size: 11.3pt ; white-space: normal&quot;&gt;流程(私钥是用来签发根证书的)&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;mspID:AAA1030TESTLOCALORDERER&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;domain:orderer.aaa1030.baas.testlocal.com&lt;/pre&gt;&lt;/pre&gt;&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="20" y="307.5" width="380" height="165" as="geometry"/>
        </mxCell>
        <mxCell id="Te6vJrgBCBY73sw6nDYi-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="MySstw2kXxZv5NEbaLpW-9" target="Te6vJrgBCBY73sw6nDYi-3">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="MySstw2kXxZv5NEbaLpW-9" value="&lt;pre style=&quot;background-color: rgb(253 , 246 , 227) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;&lt;pre style=&quot;color: rgb(88 , 110 , 117) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;GeneratePrivAndPub:生成公私钥&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;&lt;pre style=&quot;color: rgb(88 , 110 , 117) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;csp.KeyGen:(SW  CSP)生成私钥(ECDSA)&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;&lt;pre style=&quot;color: rgb(88 , 110 , 117) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;signer.New生成signer:&lt;span style=&quot;font-size: 11.3pt ; white-space: normal&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;font-size: 11.3pt ; white-space: normal ; color: rgb(181 , 137 , 0)&quot;&gt;bccspCryptoSigner&lt;/span&gt;&lt;span style=&quot;font-size: 11.3pt ; white-space: normal ; color: rgb(38 , 139 , 210)&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;font-size: 11.3pt ; white-space: normal&quot;&gt;csp, key, pk&lt;/span&gt;&lt;span style=&quot;font-size: 11.3pt ; white-space: normal ; color: rgb(38 , 139 , 210)&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;&lt;font color=&quot;#268bd2&quot;&gt;&lt;span style=&quot;white-space: normal&quot;&gt;pk:即公钥;生成流程:&lt;/span&gt;&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;&lt;pre style=&quot;color: rgb(88 , 110 , 117) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;1.pub, err := key.PublicKey()&lt;/pre&gt;&lt;pre style=&quot;color: rgb(88 , 110 , 117) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;2.&lt;span style=&quot;font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt ; white-space: normal&quot;&gt;raw, err := pub.Bytes()&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;color: rgb(88 , 110 , 117) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;3.&lt;span style=&quot;font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt ; white-space: normal&quot;&gt;pk, err := utils.DERToPublicKey(raw)&lt;/span&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="480" y="280" width="480" height="220" as="geometry"/>
        </mxCell>
        <mxCell id="Te6vJrgBCBY73sw6nDYi-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="Te6vJrgBCBY73sw6nDYi-3" target="Te6vJrgBCBY73sw6nDYi-5">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="Te6vJrgBCBY73sw6nDYi-3" value="同样的方法生成tls公私钥&lt;br&gt;然后将两类公私钥赋值给org" style="rounded=0;whiteSpace=wrap;html=1;fontSize=15;" vertex="1" parent="1">
          <mxGeometry x="990" y="350" width="210" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="Te6vJrgBCBY73sw6nDYi-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=15;" edge="1" parent="1" source="Te6vJrgBCBY73sw6nDYi-5" target="Te6vJrgBCBY73sw6nDYi-7">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="Te6vJrgBCBY73sw6nDYi-5" value="将上一步的org添加mspID和orgName等属性之后存到db的&lt;span style=&quot;color: rgb(42, 161, 152); font-family: menlo; font-size: 15px; background-color: rgb(253, 246, 227);&quot;&gt;organization表中&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=15;" vertex="1" parent="1">
          <mxGeometry x="990" y="570" width="210" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="Te6vJrgBCBY73sw6nDYi-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=15;" edge="1" parent="1" source="Te6vJrgBCBY73sw6nDYi-7" target="Te6vJrgBCBY73sw6nDYi-9">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="Te6vJrgBCBY73sw6nDYi-7" value="创建完组织之后创建user:&amp;nbsp;&lt;span style=&quot;color: rgb(88 , 110 , 117) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt ; background-color: rgb(253 , 246 , 227)&quot;&gt;svcmsp.CreateUser&lt;/span&gt;&lt;br&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="590" y="570" width="320" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="Te6vJrgBCBY73sw6nDYi-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=15;" edge="1" parent="1" source="Te6vJrgBCBY73sw6nDYi-9" target="Te6vJrgBCBY73sw6nDYi-11">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="Te6vJrgBCBY73sw6nDYi-9" value="创建Admin相关证书:&lt;br style=&quot;font-size: 15px&quot;&gt;1.读取本地org的私钥,并通过私钥获取casigner&lt;br style=&quot;font-size: 15px&quot;&gt;2.与生成org的私钥流程一样,生成Admin私钥&lt;br style=&quot;font-size: 15px&quot;&gt;3.通过私钥生成公钥&lt;br style=&quot;font-size: 15px&quot;&gt;4.用第一步的casigner(即组织的casigner)对公钥进行签名得到Admin的证书cert&lt;br&gt;5.最终的到私钥和证书,并赋值给admin相关属性,并保存在db中,本地存储私钥&lt;br&gt;6.同样的方式生成TLS的私钥和证书,私钥保存在本地" style="rounded=0;whiteSpace=wrap;html=1;align=left;fontSize=15;" vertex="1" parent="1">
          <mxGeometry x="60" y="530" width="450" height="160" as="geometry"/>
        </mxCell>
        <mxCell id="Te6vJrgBCBY73sw6nDYi-14" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=15;" edge="1" parent="1" source="Te6vJrgBCBY73sw6nDYi-11" target="Te6vJrgBCBY73sw6nDYi-13">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="Te6vJrgBCBY73sw6nDYi-11" value="orderer分类:&lt;br&gt;组织的orderer和平台的baas orderer" style="rounded=0;whiteSpace=wrap;html=1;fontSize=15;align=left;" vertex="1" parent="1">
          <mxGeometry x="130" y="750" width="310" height="100" as="geometry"/>
        </mxCell>
        <mxCell id="Te6vJrgBCBY73sw6nDYi-16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=15;" edge="1" parent="1" source="Te6vJrgBCBY73sw6nDYi-13" target="Te6vJrgBCBY73sw6nDYi-15">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="Te6vJrgBCBY73sw6nDYi-13" value="创建组织peerOrganization的CA私钥和根证书,TLS私钥和根证书流程:&lt;br&gt;mspID为:AAA1030TESTLOCALPEER&lt;br&gt;domain:peer.aaa1030.baas.testlocal.com&lt;br&gt;&lt;br&gt;流程与orderer一样,创建节点私钥和证书,创建Admin的私钥和证书,并存到db中" style="rounded=0;whiteSpace=wrap;html=1;fontSize=15;align=left;" vertex="1" parent="1">
          <mxGeometry x="520" y="730" width="310" height="140" as="geometry"/>
        </mxCell>
        <mxCell id="Te6vJrgBCBY73sw6nDYi-18" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=15;" edge="1" parent="1" source="Te6vJrgBCBY73sw6nDYi-15" target="Te6vJrgBCBY73sw6nDYi-17">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="Te6vJrgBCBY73sw6nDYi-15" value="至此ordererOrganization和peerOrganization的CA私钥和CA根证书创建完毕" style="rounded=0;whiteSpace=wrap;html=1;fontSize=15;align=left;" vertex="1" parent="1">
          <mxGeometry x="910" y="730" width="310" height="140" as="geometry"/>
        </mxCell>
        <mxCell id="Te6vJrgBCBY73sw6nDYi-17" value="生成一个orderer的私钥和证书: 私钥生成步骤跟上面组织生成私钥的步骤相同, 通过私钥获得公钥;&lt;br&gt;然后通过ordererOrganization的CA私钥和根证书对orderer的公钥签名生成该orderer的证书&lt;br&gt;&lt;pre style=&quot;background-color: rgb(253 , 246 , 227) ; color: rgb(88 , 110 , 117) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;x509.CreateCertificate(rand.Reader, &amp;amp;template, &lt;span style=&quot;color: rgb(38 , 139 , 210)&quot;&gt;ca&lt;/span&gt;.SignCert, pub, &lt;span style=&quot;color: rgb(38 , 139 , 210)&quot;&gt;ca&lt;/span&gt;.Signer)&lt;/pre&gt;&lt;pre style=&quot;background-color: rgb(253 , 246 , 227) ; color: rgb(88 , 110 , 117) ; font-family: &amp;#34;menlo&amp;#34; ; font-size: 11.3pt&quot;&gt;最后将orderer信息存到orderer表中&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=15;align=left;" vertex="1" parent="1">
          <mxGeometry x="825" y="950" width="700" height="130" as="geometry"/>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
